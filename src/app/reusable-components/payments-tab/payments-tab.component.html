<div>
  <p class="mb-2 text-center" style="font-size: 1.12rem">
    Remaining Payment:
    <span class="text-success">
      {{ currencySymbol }}{{ getTotalRemainingPaymentWithoutWaitingTime() }}
    </span>
  </p>

  <h3 *ngIf="waitingCost" class="mb-4 text-center fs-13">
    Waiting Cost:
    <span class="text-success"> {{ currencySymbol }} {{ waitingCost }} </span>
  </h3>

  <!-- Additional Costs Section -->
  <div class="mb-3">
    <div class="additionalCosts position-relative">
      <app-headline-comp title="Additional Costs"></app-headline-comp>
    </div>

    <div
      *ngFor="let cost of additionalCosts; let i = index"
      class="mt-3 d-flex justify-content-between"
    >
      <div class="flex-grow-1 d-flex gap-2 flex-column">
        <div class="d-flex justify-content-between align-item-center ms-2">
          <div class="my-auto" style="font-size: 14px">Cost {{ i + 1 }}:</div>
          <button
            type="button"
            class="btn"
            (click)="removeCost(i)"
            [disabled]="cost.addedToPayment"
            style="border: none; background: transparent; color: red"
          >
            <i class="btn-outline-success fa-solid fa-trash"></i>
          </button>
        </div>
        <input
          type="text"
          [(ngModel)]="cost.name"
          placeholder="Cost Name"
          class="form-control fs-13"
          [ngClass]="{ 'is-invalid': isCostInvalid(cost) }"
          [readonly]="cost.addedToPayment"
        />
        <input
          type="number"
          [(ngModel)]="cost.amount"
          placeholder="Enter Amount"
          class="form-control fs-13"
          [ngClass]="{ 'is-invalid': isCostInvalid(cost) }"
          (ngModelChange)="calculateTotalAdditionalPayment()"
          [readonly]="cost.addedToPayment"
        />

        <button
          class="btn btn-success fs-13 mt-2"
          (click)="addCostToPayment(cost)"
          [disabled]="!isCostValid(cost) || cost.addedToPayment"
        >
          Add to Payment
        </button>
      </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mt-2">
      <button
        class="btn btn-outline-success d-flex align-items-center justify-content-center"
        (click)="addCost()"
        style="width: 40px; height: 40px; border-radius: 50%; padding: 0"
      >
        <i class="fa-solid fa-plus"></i>
      </button>
    </div>
    <!-- Cost Breakdown Section -->
    <div class="mb-4">
      <span class="text-center d-block" style="font-size: 15px">
        Cost Breakdown
      </span>
      <ul class="list-group">
        <li
          class="list-group-item d-flex justify-content-between"
          style="font-size: 13.3px"
        >
          <strong>Remaining Payment:</strong>
          <span class="text-success">{{ currencySymbol }}500</span>
          <!-- Fixed value -->
        </li>

        <li
          *ngFor="let cost of successfulCosts; let i = index"
          class="list-group-item d-flex justify-content-between"
          style="font-size: 13.3px"
        >
          <strong>Cost {{ i + 1 }}:</strong>
          <span class="text-success"
            >{{ currencySymbol }}{{ cost.amount }}</span
          >
        </li>

        <li
          class="list-group-item d-flex justify-content-between"
          style="font-size: 13.3px"
        >
          <strong>Total Remaining Cost:</strong>
          <strong class="text-success"
            >{{ currencySymbol }}{{ getTotalRemainingCost() }}</strong
          >
        </li>
      </ul>
    </div>

    <!-- Payment Options Section -->
    <div class="my-2">
      <app-headline-comp title="Choose a Payment Option"></app-headline-comp>

      <div class="form-check my-3">
        <label class="form-check-label fs-13">
          <input
            type="radio"
            class="form-check-input"
            name="paymentMethod"
            (click)="selectPaymentMethod('cash')"
          />
          Cash
        </label>
        <div *ngIf="selectedPaymentMethod === 'cash'" class="mt-2">
          <label class="form-label fs-13">Amount Collected:</label>
          <input
            type="number"
            class="form-control fs-13"
            [(ngModel)]="collectedAmount"
            placeholder="Enter amount"
          />
        </div>
      </div>

      <div class="form-check mb-3">
        <label class="form-check-label fs-13">
          <input
            type="radio"
            class="form-check-input"
            name="paymentMethod"
            (click)="selectPaymentMethod('card')"
          />
          Charged the card on machine
        </label>
        <div *ngIf="selectedPaymentMethod === 'card'" class="mt-2">
          <label class="form-label fs-13">Amount Charged:</label>
          <input
            type="number"
            class="form-control fs-13"
            [(ngModel)]="collectedAmount"
            placeholder="Enter amount charged"
          />
        </div>
      </div>

      <div class="form-check mb-3">
        <label class="form-check-label fs-13">
          <input
            type="radio"
            class="form-check-input"
            name="paymentMethod"
            (click)="selectPaymentMethod('other')"
          />
          Other Payment Option
        </label>
        <div *ngIf="selectedPaymentMethod === 'other'" class="mt-2">
          <textarea
            class="form-control fs-13"
            [(ngModel)]="otherPaymentDetails"
            placeholder="Enter payment details"
          ></textarea>
        </div>
      </div>
    </div>

    <!-- Finalize Payment Button -->
    <div class="text-center my-3">
      <button
        class="btn btn-lg finalizePayment fs-13"
        (click)="finalizePayment()"
        [disabled]="
          !isPaymentAdded &&
          (additionalCosts.length > 0 ||
            getTotalRemainingPaymentWithoutWaitingTime() <= 0)
        "
      >
        Finalize Payment
      </button>
    </div>

    <div
      *ngIf="paymentStatus && !isFormValid()"
      class="alert alert-danger mt-3 text-center fs-13"
    >
      {{ paymentStatus }}
    </div>

    <!-- Error Popup -->
    <div *ngIf="showErrorPopup" class="alert alert-danger text-center fs-13">
      Before selecting payment option, please enter cost name, amount, and add
      to payment first.
    </div>

    <!-- Success Message -->
    <div
      *ngIf="showSuccessMessage"
      class="alert alert-success text-center fs-13"
    >
      Costs added successfully! Now you can choose a payment option.
    </div>
  </div>
</div>
